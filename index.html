<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AyuGram Desktop — современный Telegram‑клиент</title>
  <style>
    :root{
      --bg: #0b1220;
      --bg-soft: #0e1726;
      --text: #e9f2ff;
      --muted: #9fb2cf;
      --brand: #5ad1ff;
      --accent: #7cf4c9;
      --round: 16px;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --toolbar-h: 38px;
      --toolbar-brd: rgba(255,255,255,.12);
      --win-dot: 10px;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1000px 600px at 120% -20%, rgba(90,209,255,.08), transparent 60%),
        radial-gradient(900px 600px at -20% 120%, rgba(124,244,201,.08), transparent 60%),
        var(--bg);
      color: var(--text); line-height: 1.4;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    a{ color: #cfeaff; text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .nav {
      position: sticky; top:0; z-index: 10;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(13,20,35,.7), rgba(13,20,35,.45));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .nav-inner {
      max-width: 1200px; margin: 0 auto; padding: 10px 20px;
      display:flex; align-items:center; justify-content:space-between; gap: 14px;
    }
    .brand{ display:flex; align-items:center; gap: 8px; font-weight: 700; }
    .brand-logo{
      width: 24px; height: 24px; border-radius: 6px;
      background: conic-gradient(from 210deg, var(--brand), var(--accent));
      box-shadow: inset 0 0 12px rgba(255,255,255,.35), 0 2px 10px rgba(0,0,0,.25);
    }
    .menu{ display:flex; gap: 14px; flex-wrap: wrap; }
    .menu a{ padding:8px 10px; border-radius: 8px; color:#cfe7ff; }
    .menu a.active, .menu a:hover{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      text-decoration:none;
    }
    .cta{ display:flex; gap:8px; }
    .btn{
      appearance:none; border: 0; padding: 10px 14px; border-radius: 10px;
      background: linear-gradient(180deg, rgba(90,209,255,.25), rgba(124,244,201,.2));
      color:#0b1424; font-weight: 700; cursor: pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.3);
      transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.35); }
    .btn:active{ transform: translateY(0); }
    .btn.ghost{
      background: rgba(255,255,255,.04); color: #dfeeff;
      border: 1px solid rgba(255,255,255,.14); font-weight: 600;
      box-shadow: 0 6px 16px rgba(0,0,0,.2);
    }
    .btn.secondary{
      background: linear-gradient(180deg, rgba(124,244,201,.28), rgba(90,209,255,.2));
    }
    .btn-small{ padding: 8px 10px; font-size: 13px; }

    .hero{
      max-width: 1200px; margin: 28px auto; padding: 0 20px;
      display:grid; gap: 16px; grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 900px){ .hero { grid-template-columns: 1fr; } }

    .hero-card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--round);
      padding: 22px; box-shadow: var(--shadow);
    }
    .hero-card h1{
      margin: 10px 0 10px; font-size: 34px; line-height: 1.15;
      background: linear-gradient(90deg, #eaf4ff, #bfe7ff);
      -webkit-background-clip:text; background-clip: text; color: transparent;
    }
    .lead { color: var(--muted); margin-bottom: 20px; font-size: 18px; }
    .chip {
      display:inline-flex; gap:8px; align-items:center;
      background: rgba(90,209,255,.15);
      border: 1px solid rgba(90,209,255,.35);
      color: #cfeeff; padding:6px 10px; border-radius: 999px; font-size: 13px; margin-bottom: 12px;
      transition: opacity .2s ease;
    }
    .hero-actions { display:flex; gap:10px; flex-wrap: wrap; }

    .showcase {
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--round);
      padding: 0; position: relative; overflow: hidden; min-height: 320px;
      box-shadow: var(--shadow);
    }
    .showcase .toolbar {
      height: var(--toolbar-h);
      display:flex; align-items:center; gap:10px;
      padding: 0 12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-bottom: 1px solid var(--toolbar-brd);
      position: sticky; top:0; z-index: 1;
    }
    .showcase .toolbar .dots {
      display:flex; align-items:center; gap:8px;
      transform: translateZ(0);
    }
    .dot {
      width: var(--win-dot);
      height: var(--win-dot);
      border-radius: 50%;
      display:inline-block;
      box-shadow:
        inset 0 -1px 2px rgba(0,0,0,.35),
        0 0 0 1px rgba(0,0,0,.15);
      position: relative;
      transition: transform .12s ease, box-shadow .12s ease, opacity .2s ease;
    }
    .dot::after{
      content:"";
      position:absolute; inset:0;
      border-radius:50%;
      background: radial-gradient(8px 8px at 35% 30%, rgba(255,255,255,.55), transparent 55%);
      mix-blend-mode: screen;
      pointer-events:none;
    }
    .dot.red{ background:#ff5f56; }
    .dot.yellow{ background:#ffbd2e; }
    .dot.green{ background:#27c93f; }
    .toolbar:hover .dot{ transform: translateY(-1px); box-shadow:
      inset 0 -1px 2px rgba(0,0,0,.35),
      0 2px 6px rgba(0,0,0,.25),
      0 0 0 1px rgba(0,0,0,.15);
    }
    .showcase .title {
      margin-left: auto;
      color: var(--muted);
      font-size: 13px;
      user-select: none;
      opacity:.9;
    }
    .showcase .screen {
      background: #0c1320;
      border-radius: 0 0 var(--round) var(--round);
      border-top: 0;
      border: 0;
      height: 274px;
      overflow: hidden; position: relative;
    }
    .screen::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(600px 220px at -10% -60%, rgba(90,209,255,.08), transparent 60%),
        radial-gradient(500px 220px at 110% 120%, rgba(124,244,201,.08), transparent 60%);
      pointer-events:none;
    }
    canvas#preview {
      width:100%; height:100%; display:block;
    }

    section {
      max-width: 1200px; margin: 40px auto; padding: 0 20px;
    }
    .section-title {
      font-size: 28px; margin: 0 0 16px;
    }
    .grid {
      display:grid; gap:16px; grid-template-columns: repeat(3, 1fr);
    }
    @media (max-width: 1000px){ .grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px){ .grid { grid-template-columns: 1fr; } }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--round); padding: 18px; box-shadow: var(--shadow);
    }
    .feature {
      display:flex; gap:14px; align-items:flex-start;
    }
    .feature .icon {
      width:38px; height:38px; border-radius: 10px; flex: 0 0 38px;
      background: linear-gradient(135deg, rgba(90,209,255,.25), rgba(124,244,201,.25));
      border: 1px solid rgba(255,255,255,.18);
      display:grid; place-items:center; color:#dff8ff;
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .muted { color: var(--muted); }

    .stack {
      display:grid; gap:12px; grid-template-columns: repeat(5, minmax(0,1fr));
    }
    @media (max-width: 900px){ .stack { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    .tech {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px; padding: 12px;
      display:flex; gap:10px; align-items:center;
    }
    .tech .badge {
      width:28px; height:28px; border-radius: 8px;
      background: linear-gradient(135deg, var(--brand), var(--accent));
      box-shadow: inset 0 0 16px rgba(255,255,255,.25);
    }

    .install {
      display:grid; gap:16px; grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 900px){ .install { grid-template-columns: 1fr; } }
    pre.code {
      background: #0a1220; color:#eaf3ff; border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px; padding: 14px; overflow:auto; font-size: 14px; line-height:1.45;
      box-shadow: var(--shadow);
      white-space: pre-wrap;
    }
    .code .hint { color:#8ec9ff; }
    .code .cmd { color:#7cf4c9; }
    .code .comment { color:#7086a7; }

    .releases .release {
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px; border-radius: 12px;
      background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.12);
      gap: 12px;
    }
    .release .ver { font-weight: 700; }
    .release .date { color: var(--muted); font-size: 14px; }
    .release .tags {
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .tag {
      font-size: 12px; padding: 4px 8px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14); color:#cfe7ff; background: rgba(255,255,255,.06);
    }

    footer {
      margin-top: 60px;
      border-top: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
    }
    .foot-inner {
      max-width: 1200px; margin: 0 auto; padding: 18px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap;
    }
    .small { font-size: 13px; color: var(--muted); }

    .toast {
      position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: rgba(14,20,32,.9); border: 1px solid rgba(255,255,255,.12);
      color: var(--text); padding: 12px 16px; border-radius: 12px; box-shadow: var(--shadow);
      opacity:0; transition: .25s ease; pointer-events:none;
    }
    .toast.show { opacity:1; transform: translateX(-50%) translateY(0); }
    .sr-only {
      position:absolute !important;
      height:1px;width:1px;
      overflow:hidden;
      clip:rect(1px, 1px, 1px, 1px);
      white-space:nowrap;
    }
  </style>
  <script type="importmap">
  {
    "imports": { }
  }
  </script>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div class="brand-name">AyuGram Desktop</div>
      </div>
      <nav class="menu" aria-label="Основное меню">
        <a href="#features" class="active">Особенности</a>
        <a href="#tech">Технологии</a>
        <a href="#install">Установка</a>
        <a href="#releases">Релизы</a>
      </nav>
      <div class="cta">
        <button class="btn" id="downloadBtn" type="button">Скачать</button>
        <button class="btn ghost" id="githubBtn" type="button">GitHub</button>
      </div>
    </div>
  </header>

  <main>
    <div class="hero">
      <div class="hero-card">
        <span class="chip" aria-live="polite">
          <span>🚀</span>
          <span id="chipText">Оптимизировано для Desktop</span>
        </span>
        <h1>Мощный Telegram‑клиент с расширенными возможностями</h1>
        <p class="lead">AyuGram Desktop — открытый форк с фокусом на удобство, приватность и кастомизацию. Легко собирается из исходников, быстро работает и выглядит превосходно.</p>
        <div class="hero-actions">
          <button class="btn secondary" id="primaryDownload" type="button">Скачать релиз</button>
          <button class="btn ghost" id="buildGuide" type="button">Инструкция по сборке</button>
        </div>
      </div>
      <div class="showcase" aria-label="Демонстрация интерфейса">
        <div class="toolbar" role="presentation">
          <div class="dots" aria-hidden="true">
            <span class="dot red"></span>
            <span class="dot yellow"></span>
            <span class="dot green"></span>
          </div>
          <div class="title" aria-hidden="true">AyuGram — Preview</div>
        </div>
        <div class="screen">
          <canvas id="preview" aria-label="Превью интерфейса"></canvas>
        </div>
      </div>
    </div>

    <section id="features">
      <h2 class="section-title">Почему AyuGram Desktop</h2>
      <div class="grid">
        <div class="card feature">
          <div class="icon" aria-hidden="true">⚙️</div>
          <div>
            <div><strong>Расширенные настройки</strong></div>
            <div class="muted">Гибкая конфигурация поведения, уведомлений и интерфейса — под ваш стиль работы.</div>
          </div>
        </div>
        <div class="card feature">
          <div class="icon" aria-hidden="true">🛡️</div>
          <div>
            <div><strong>Фокус на приватности</strong></div>
            <div class="muted">Рациональные дефолты, понятные переключатели и прозрачные параметры безопасности.</div>
          </div>
        </div>
        <div class="card feature">
          <div class="icon" aria-hidden="true">🎨</div>
          <div>
            <div><strong>Темы и кастомизация</strong></div>
            <div class="muted">Поддержка тем, плавные анимации, аккуратные шрифты и продуманная палитра.</div>
          </div>
        </div>
        <div class="card feature">
          <div class="icon" aria-hidden="true">⚡</div>
          <div>
            <div><strong>Производительность</strong></div>
            <div class="muted">Быстрый рендеринг, оптимизация ресурсов и экономия памяти.</div>
          </div>
        </div>
        <div class="card feature">
          <div class="icon" aria-hidden="true">🔧</div>
          <div>
            <div><strong>Открытый исходный код</strong></div>
            <div class="muted">Прозрачно, расширяемо и поддерживаемо сообществом разработчиков.</div>
          </div>
        </div>
        <div class="card feature">
          <div class="icon" aria-hidden="true">🌐</div>
          <div>
            <div><strong>Кроссплатформенность</strong></div>
            <div class="muted">Windows, macOS и Linux — комфортно везде.</div>
          </div>
        </div>
      </div>
    </section>

    <section id="tech">
      <h2 class="section-title">Технологический стек</h2>
      <div class="stack">
        <div class="tech"><div class="badge" aria-hidden="true"></div><div>Qt / C++</div></div>
        <div class="tech"><div class="badge" aria-hidden="true"></div><div>TDLib</div></div>
        <div class="tech"><div class="badge" aria-hidden="true"></div><div>OpenSSL</div></div>
        <div class="tech"><div class="badge" aria-hidden="true"></div><div>MTProto</div></div>
        <div class="tech"><div class="badge" aria-hidden="true"></div><div>Сборка CI</div></div>
      </div>
    </section>

    <section id="install" class="install">
      <div>
        <h2 class="section-title">Установка и сборка</h2>
        <div class="card">
          <p class="muted">Быстрый старт — скачайте готовый релиз для вашей платформы. Разработчикам доступна сборка из исходников.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn" data-os="win" type="button">Windows</button>
            <button class="btn ghost" data-os="mac" type="button">macOS</button>
            <button class="btn ghost" data-os="linux" type="button">Linux</button>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
            <div class="icon" style="width:30px;height:30px;">💻</div>
            <strong>Соберите локально</strong>
          </div>
          <pre class="code"><span class="comment"># Клонируйте репозиторий</span>
<span class="cmd">git clone https://github.com/AyuGram/AyuGramDesktop.git</span>
<span class="cmd">cd AyuGramDesktop</span>

<span class="comment"># Инициализация субмодулей (если применимо)</span>
<span class="cmd">git submodule update --init --recursive</span>

<span class="comment"># Установите зависимости (Qt, инструменты сборки и т.д.)</span>
<span class="comment"># Далее соберите проект согласно инструкции в README</span>
<span class="hint"># Пример (зависит от конкретного build-scripts):</span>
<span class="cmd">cmake -B build -S . -DCMAKE_BUILD_TYPE=Release</span>
<span class="cmd">cmake --build build -j</span></pre>
        </div>
      </div>
    </section>

    <section id="releases" class="releases">
      <h2 class="section-title">Последние релизы</h2>
      <div class="grid" id="releasesGrid" aria-live="polite" aria-busy="true">
      </div>
      <div class="small" style="margin-top:10px;">Данные загружаются динамически. При отсутствии сети будут показаны локальные шаблоны.</div>
    </section>
  </main>

  <footer>
    <div class="foot-inner">
      <div class="brand" style="gap:10px;">
        <div class="brand-logo" style="width:28px;height:28px;"></div>
        <div>AyuGram Desktop</div>
      </div>
      <div class="small">© <span id="year"></span> Сообщество AyuGram. Неофициальный клиент Telegram.</div>
      <div class="small">
        <a href="#" id="licenseLink">Лицензия</a> ·
        <a href="#" id="privacyLink">Приватность</a>
      </div>
    </div>
  </footer>

  <div class="toast" id="toast" role="status" aria-live="polite">Ссылка скопирована</div>
  <span id="a11y-announcer" class="sr-only" aria-live="polite"></span>

  <script type="module">
    // Utilities
    const $ = (q, root=document) => root.querySelector(q);
    const $$ = (q, root=document) => Array.from(root.querySelectorAll(q));
    const toastEl = $('#toast');
    const announcer = $('#a11y-announcer');
    const announce = (msg) => { announcer.textContent = ''; setTimeout(()=>announcer.textContent = msg, 10); };
    const showToast = (msg, timeout=2000) => {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      announce(msg);
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toastEl.classList.remove('show'), timeout);
    };

    // Dynamic year
    $('#year').textContent = new Date().getFullYear();

    // Buttons
    const GITHUB_URL = 'https://github.com/AyuGram/AyuGramDesktop';
    const safeOpen = (url) => {
      try { window.open(url, '_blank', 'noopener,noreferrer'); }
      catch { window.location.href = url; }
    };
    $('#githubBtn').addEventListener('click', () => safeOpen(GITHUB_URL));
    // Главная кнопка "Скачать" ведет на страницу релизов
    $('#downloadBtn').addEventListener('click', () => {
      safeOpen('https://github.com/AyuGram/AyuGramDesktop/releases');
    });
    // Кнопка "Скачать релиз" открывает именно страницу последних релизов
    $('#primaryDownload').addEventListener('click', () => {
      safeOpen('https://github.com/AyuGram/AyuGramDesktop/releases');
    });
    $('#buildGuide').addEventListener('click', () => {
      safeOpen(GITHUB_URL + '#readme');
    });
    $$('#install .btn[data-os]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const os = btn.dataset.os;
        safeOpen('https://github.com/AyuGram/AyuGramDesktop/releases');
        showToast(`Открыл страницу релизов (${os})`);
      });
    });
    $('#licenseLink').addEventListener('click', e=>{
      e.preventDefault();
      safeOpen(GITHUB_URL + '/blob/master/LICENSE');
    });
    $('#privacyLink').addEventListener('click', e=>{
      e.preventDefault();
      showToast('См. политику в документации проекта');
    });

    // Hero chip cycle
    const chipPhrases = [
      'Оптимизировано для Desktop',
      'Приятные темы и анимации',
      'Фокус на приватности',
      'Открытый исходный код'
    ];
    const chipTextEl = $('#chipText');
    let chipIndex = 0;
    setInterval(()=>{
      chipIndex = (chipIndex+1) % chipPhrases.length;
      const chipWrap = chipTextEl.parentElement;
      chipWrap.style.opacity = 0;
      setTimeout(()=>{
        chipTextEl.textContent = chipPhrases[chipIndex];
        chipWrap.style.opacity = 1;
      }, 180);
    }, 2500);

    // Canvas rendering
    const canvas = $('#preview');
    const ctx = canvas.getContext('2d');

    function getSize() {
      const rect = canvas.getBoundingClientRect();
      return { w: Math.max(1, rect.width|0), h: Math.max(1, rect.height|0) };
    }

    function resizeCanvas() {
      const { w, h } = getSize();
      const dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
      const bw = Math.floor(w * dpr), bh = Math.floor(h * dpr);
      if (canvas.width !== bw || canvas.height !== bh) {
        canvas.width = bw;
        canvas.height = bh;
      }
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
      drawUI(w, h);
    }
    const ro = new ResizeObserver(resizeCanvas);
    ro.observe(canvas);
    document.addEventListener('visibilitychange', ()=>{
      if (document.visibilityState === 'visible') resizeCanvas();
    });
    window.addEventListener('load', resizeCanvas);

    function roundRect(ctx, x, y, w, h, r) {
      const rr = Math.max(0, Math.min(r, w/2, h/2));
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function drawUI(w, h) {
      ctx.clearRect(0, 0, w, h);

      const grd = ctx.createLinearGradient(0, 0, 0, h);
      grd.addColorStop(0, '#0e1726');
      grd.addColorStop(1, '#0a1120');
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, w, h);

      const sidebarW = Math.max(180, Math.min(260, w*0.28));
      ctx.fillStyle = '#0b1626';
      ctx.fillRect(0, 0, sidebarW, h);

      const itemH = 28;
      const startY = 60;
      for (let i=0;i<10;i++){
        const y = startY + i*(itemH+8);
        ctx.fillStyle = i % 3 === 0 ? 'rgba(124,244,201,.12)' : 'rgba(255,255,255,.06)';
        roundRect(ctx, 12, y, Math.max(60, sidebarW-24), itemH, 8);
        ctx.fill();
        ctx.fillStyle = 'rgba(90,209,255,.25)';
        roundRect(ctx, 18, y+6, 16, 16, 5);
        ctx.fill();
        ctx.fillStyle = 'rgba(223,239,255,.8)';
        roundRect(ctx, 38, y+7, Math.max(40, sidebarW-60), 12, 6);
        ctx.fill();
      }

      const headH = 44;
      ctx.fillStyle = 'rgba(255,255,255,.04)';
      ctx.fillRect(sidebarW, 0, Math.max(1, w - sidebarW), headH);
      const pillW = Math.min(220, Math.max(140, (w - sidebarW) * 0.35));
      ctx.fillStyle = 'rgba(255,255,255,.08)';
      roundRect(ctx, w - pillW - 16, 8, pillW, 28, 14);
      ctx.fill();
      ctx.fillStyle = 'rgba(200,230,255,.8)';
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Search…', w - pillW - 16 + 14, 26);

      const areaX = sidebarW + 12;
      const areaY = headH + 12;
      const areaW = Math.max(1, w - areaX - 12);
      const areaH = Math.max(1, h - areaY - 12);

      let y = areaY;
      const lines = 9;
      for (let i=0;i<lines;i++){
        const isMe = i % 2 === 0;
        const bubbleW = Math.max(140, Math.min(areaW * 0.78, 260 + ((i*37)%120)));
        const bx = isMe ? areaX + areaW - bubbleW - 6 : areaX + 6;
        const by = y;
        const bh = 32 + ((i*29) % 24);
        ctx.fillStyle = isMe ? 'rgba(124,244,201,.18)' : 'rgba(90,209,255,.18)';
        roundRect(ctx, bx, by, bubbleW, bh, 10);
        ctx.fill();
        ctx.fillStyle = 'rgba(230,245,255,.85)';
        roundRect(ctx, bx+10, by+8, bubbleW*0.6, 8, 5); ctx.fill();
        ctx.fillStyle = 'rgba(210,230,255,.6)';
        roundRect(ctx, bx+10, by+20, bubbleW*0.85, 6, 4); ctx.fill();
        y += bh + 10;
        if (y > areaY + areaH - 80) break;
      }

      const ibH = 38;
      const sendW = 84;
      ctx.fillStyle = 'rgba(255,255,255,.06)';
      roundRect(ctx, areaX, h - ibH - 10, Math.max(60, areaW - (sendW + 16)), ibH, 12);
      ctx.fill();
      ctx.fillStyle = 'rgba(210,230,255,.7)';
      ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Напишите сообщение…', areaX + 12, h - ibH + 14);
      ctx.fillStyle = 'rgba(124,244,201,.25)';
      roundRect(ctx, areaX + areaW - sendW, h - ibH - 10, sendW, ibH, 12);
      ctx.fill();
      ctx.fillStyle = '#dffdf2';
      ctx.font = 'bold 13px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Отправить', areaX + areaW - sendW + 10, h - ibH + 14);
    }

    let t = 0;
    let rafId = null;
    function frame() {
      if (document.visibilityState !== 'visible') return;
      t += 1;
      const { w, h } = getSize();
      if (t % 2 === 0) drawUI(w, h);
      const sidebarW = Math.max(180, Math.min(260, w*0.28));
      const grad = ctx.createLinearGradient(0, 0, sidebarW, 0);
      const shift = (Math.sin(t/40)+1)/2;
      grad.addColorStop(Math.max(0, shift-0.2), 'rgba(255,255,255,0)');
      grad.addColorStop(shift, 'rgba(255,255,255,0.06)');
      grad.addColorStop(Math.min(1, shift+0.2), 'rgba(255,255,255,0)');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, sidebarW, h);
      rafId = requestAnimationFrame(frame);
    }
    const startAnim = ()=>{ if (!rafId) rafId = requestAnimationFrame(frame); };
    const stopAnim = ()=>{ if (rafId) cancelAnimationFrame(rafId); rafId = null; };
    document.addEventListener('visibilitychange', ()=>{
      if (document.visibilityState === 'visible') { resizeCanvas(); startAnim(); }
      else stopAnim();
    });
    window.addEventListener('load', ()=>{ resizeCanvas(); startAnim(); });

   // Releases: GitHub API with correct links, fallback to local mock
async function loadReleases() {
  const container = $('#releasesGrid');
  container.innerHTML = '';
  container.setAttribute('aria-busy', 'true');
  let releases = null;
  let usedFallback = false;
  try {
    const res = await fetch('https://api.github.com/repos/AyuGram/AyuGramDesktop/releases', {
      headers: { 'Accept': 'application/vnd.github+json' },
      cache: 'no-store',
      mode: 'cors'
    });
    if (!res.ok) throw new Error('API error: ' + res.status);
    releases = await res.json();
  } catch (e) {
    usedFallback = true;
    releases = [
      { name: 'v5.16.4', tag_name: 'v5.16.4', published_at: '2025-07-20T12:00:00Z', prerelease:false, draft:false, html_url: 'https://github.com/AyuGram/AyuGramDesktop/releases/tag/v5.16.4' },
      { name: 'v1.3.0', tag_name: 'v1.3.0', published_at: '2024-07-01T10:00:00Z', prerelease:false, draft:false, html_url: 'https://github.com/AyuGram/AyuGramDesktop/releases/tag/v1.3.0' }
    ];
  }

  // убираем draft и сортируем по дате
  releases = releases
    .filter(r => !r.draft)
    .sort((a, b) => new Date(b.published_at) - new Date(a.published_at));

  const fmt = (iso)=> new Date(iso).toLocaleDateString('ru-RU', {
    year:'numeric', month:'long', day:'numeric'
  });

  releases.slice(0,6).forEach(rel=>{
    const el = document.createElement('div');
    el.className = 'card release';
    const tags = [];
    if (rel.prerelease) tags.push('<span class="tag">pre‑release</span>');
    const relName = (rel.name || rel.tag_name || 'release').toString();
    const relUrl = rel.html_url || `${GITHUB_URL}/releases/tag/${encodeURIComponent(rel.tag_name)}`;
    el.innerHTML = `
      <div>
        <div class="ver">${relName}</div>
        <div class="date">Опубликовано: ${fmt(rel.published_at || Date.now())}</div>
      </div>
      <div class="tags">${tags.join('')}</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn ghost btn-small open-release" type="button">Открыть</button>
        <button class="btn btn-small copy-link" type="button">Скопировать ссылку</button>
      </div>
    `;
    el.querySelector('.open-release').addEventListener('click', ()=> safeOpen(relUrl));
    el.querySelector('.copy-link').addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(relUrl);
        showToast('Ссылка на релиз скопирована');
      } catch {
        showToast('Не удалось скопировать, откроем страницу');
        safeOpen(relUrl);
      }
    });
    container.appendChild(el);
  });
  container.removeAttribute('aria-busy');
  if (usedFallback) showToast('Показаны офлайн‑данные релизов');
}
  </script>
</body>
</html>
